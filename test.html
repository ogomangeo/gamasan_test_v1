<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title><%= locals.title %></title>
    <style>
        .search-container { max-width: 1200px; margin: 2rem auto; padding: 1rem; }
        .search-form { margin-bottom: 2rem; }
        .keyword-input { width: 100%; padding: 0.5rem; margin-bottom: 1rem; }
        .search-button { padding: 0.5rem 2rem; background: #03C75A; color: white; border: none; }
        .result-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .result-table th, .result-table td { border: 1px solid #ddd; padding: 0.5rem; text-align: center; }
        .device-header { background-color: #f5f5f5; }
    </style>
</head>
<body>
    <div class="search-container">
        <h1>네이버 키워드 검색 도구</h1>
        
        <div class="search-form">
            <input type="text" id="keyword" class="keyword-input" placeholder="키워드를 입력하세요">
            <button onclick="searchKeyword()" class="search-button">검색</button>
        </div>
        
        <div id="results">
            <table class="result-table">
                <thead>
                    <tr>
                        <th rowspan="2">키워드</th>
                        <th colspan="2">월간 검색수</th>
                        <th colspan="2">월평균 클릭수</th>
                        <th colspan="2">월평균 클릭률</th>
                    </tr>
                    <tr class="device-header">
                        <th>PC</th>
                        <th>모바일</th>
                        <th>PC</th>
                        <th>모바일</th>
                        <th>PC</th>
                        <th>모바일</th>
                    </tr>
                </thead>
                <tbody id="resultBody"></tbody>
            </table>
        </div>
    </div>

    <script>
    async function searchKeyword() {
        const keyword = document.getElementById('keyword').value;
        if (!keyword) {
            alert('키워드를 입력해주세요');
            return;
        }

        try {
            const response = await fetch('/keyword/searchad', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ keyword })
            });

            const data = await response.json();
            if (data.error) {
                alert(data.error);
                return;
            }

            displayResults(data);
        } catch (error) {
            alert('검색 중 오류가 발생했습니다.');
            console.error(error);
        }
    }

    function calculateClickRate(clicks, searches) {
        if (searches === '<10' || searches === '0' || clicks === '0') return '0.00%';
        const searchNum = parseInt(searches);
        const clickNum = parseInt(clicks);
        return ((clickNum / searchNum) * 100).toFixed(2) + '%';
    }

    function displayResults(data) {
        const tbody = document.getElementById('resultBody');
        tbody.innerHTML = '';

        data.keywordList.forEach(item => {
            const row = tbody.insertRow();
            row.insertCell(0).textContent = item.relKeyword;
            row.insertCell(1).textContent = item.monthlyPcQcCnt;
            row.insertCell(2).textContent = item.monthlyMobileQcCnt;
            row.insertCell(3).textContent = item.monthlyAvePcClkCnt;
            row.insertCell(4).textContent = item.monthlyAveMobileClkCnt;
            row.insertCell(5).textContent = calculateClickRate(item.monthlyAvePcClkCnt, item.monthlyPcQcCnt);
            row.insertCell(6).textContent = calculateClickRate(item.monthlyAveMobileClkCnt, item.monthlyMobileQcCnt);
        });
    }
    </script>
</body>
</html>