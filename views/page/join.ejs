<style>
  .join-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
    color: #666;
  }

  .join-form-group {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 10px 0;
  font-size: 14px;
  width: 100%;
  max-width: 500px;  /* 폼 그룹 최대 너비 */
  margin-left: auto;
  margin-right: auto;
}

.join-form-group label {
  width: 25%;
  margin-right: 20px;
  text-align: right;
  color: #555;
}

.join-form-group input,
.join-form-group select {
  width: 70%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-sizing: border-box;
}

.join-required-section {
  width: 100%;
  margin: 0 auto;
  padding-bottom: 20px;
}

.join-h3 {
  font-size: 1em;
  color: #555;
  margin: 10px 0;
  text-align: center;  /* 제목 중앙 정렬 */
}

.join-h2 {
  text-align: center;
  color: black;
  margin-bottom: 30px;
}

.join-button {
  width: 100%;
  max-width: 400px;  /* 버튼 너비 조정 */
  padding: 12px;
  background-color: #000080;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  display: block;
  margin: 30px auto;
  font-size: 16px;
}

.join-benefits {
  background-color: #f8f8f8;
  border: 1px solid #ddd;
  padding: 20px;
  border-radius: 8px;
  margin: 20px auto;
  text-align: center;
}

  .join-benefits h3 {
    font-size: 1.1em;
    color: #333;
    margin-bottom: 10px;
  }

  .join-benefits ul {
    margin: 0;
    padding: 0;
  }

/* 약관 섹션 스타일 수정 */
.join-agreement-section {
  max-width: 500px;  /* 약관 섹션 최대 너비 */
  margin: 20px auto;
  padding: 20px 0;
  display: flex;
  flex-direction: column;  /* 세로 배치로 변경 */
  gap: 20px;
}

.join-agreement-container {
  width: 100%;
  margin: 0 auto;
  background-color: #fff;
  border-radius: 8px;
}

  .join-agreement-box {
    height: 200px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    margin-bottom: 10px;
    font-size: 12px;
    line-height: 1.6;
    display: none;
  }

  .join-agreement-box.show {
    display: block;
  }

  .join-agreement-check {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    margin: 15px 0;
  }

  .join-agreement-check input[type="checkbox"] {
    width: 16px;
    height: 16px;
  }

  .join-optional-notice {
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    background-color: #f8f8f8;
    margin-top: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
    padding: 10px;
    line-height: 1.5;
    font-size: 14px;
  }

  .join-optional-desc {
    color: #666;
  }

  .join-optional-warning {
    color: #ff4444;
    font-weight: 500;
  }

  /* 약관 토글 관련 스타일 */
  .join-agreement-header {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 10px;
  background-color: #f8f8f8;
  border-radius: 4px;
  border: 1px solid #ddd;
}

.join-agreement-header h3 {
  margin: 0;
  flex-grow: 1;
}

.join-agreement-box {
  height: 200px;
  overflow-y: auto;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background-color: #fff;
  margin: 10px 0;
  font-size: 13px;
  line-height: 1.6;
  display: none;
}

  .join-agreement-toggle {
    margin-left: 10px;
    transition: transform 0.3s ease;
  }

  .join-agreement-toggle.active {
    transform: rotate(180deg);
  }
</style>

<div class="join-container">
  <h2 class="join-h2">Avopic 회원가입</h2>

  <form id="join-signupForm">

    <!-- 혜택 소개 섹션 -->
    <div class="join-benefits">
      <h3>🎉 특별한 시작, 당신과 함께합니다! 🎉</h3><br>
      <p><strong>새롭게 오픈한 Avopic 홈페이지에 오신 것을 환영합니다!</strong> <br><br> 🌐 지금 회원가입하시면 특별한 초기 멤버가 되어 다양한 혜택을 누리실 수 있습니다. 🎁
      </p>
      <ul>
        <li>👤 <strong>회원 전용 아이디:</strong> 초기 멤버로 가입하시면, 서비스가 발전했을 때 특별한 아이디로 차별화된 대우를 받으실 수 있습니다! ✨</li><br>
        <li>💸 <strong>특별 할인 혜택:</strong> 앞으로 출시될 다양한 상품을 초기 멤버에게만 제공되는 특별 혜택으로 만나보세요! 🛍️</li><br>
        <li>🎈 <strong>재미와 정보가 가득한 커뮤니티:</strong> 재미있는 자료, 흥미로운 내용들을 공유하며 즐거운 시간을 보내세요. 🎉</li><br>
        <li>🛠️ <strong>함께 성장하는 기회:</strong> 많은 기능이 준비 중입니다.보다 더 나은 홈페이지로 발전하겠습니다. 🌱</li>
      </ul>
      <p>👉 <strong>지금 바로 회원가입하고 특별한 혜택을 누려보세요!</strong> 🎊</p>
    </div>

    <!-- 약관 동의 섹션 -->

    <!-- 필수 약관 부분 수정 -->
    <div class="join-agreement-container">
      <div class="join-agreement-header" onclick="toggleAgreement('required-agreement-box')">
        <h3 class="join-h3">(필수) 개인정보 수집 및 이용 동의</h3>
        <span class="join-agreement-toggle">▼</span>
      </div>
      <div id="required-agreement-box" class="join-agreement-box">
        <p>AVOPIC는 아래와 같이 개인정보를 수집 및 이용합니다.</p>
        <p><strong>01 개인정보의 처리 목적</strong><br>
          회사는 이용자의 개인정보를 다음과 같은 목적으로만 처리합니다.</p>
        <p>1. 회원가입 및 관리<br>
          회원 가입 및 탈퇴 의사 확인, 연령 확인, 이용자 및 법정대리인의 본인 확인, 법정대리인의 동의 여부 확인, 회원제 서비스 제공에 따른 본인 식별・인증, 회원정보 갱신 및 이용한도 상향,
          중복가입
          방지, 회원자격 유지・관리, 각종 고지・통지, 분쟁조정, 고충처리 목적으로 개인정보를 처리합니다.</p>

        <p>2. 서비스 제공<br>
          서비스 이용에 필요한 요금결제∙정산, 주문 처리 및 상품 배송, 제휴서비스 제공, 광고성 정보 전송, 제휴사 이벤트 등 마케팅 활용의 목적으로 개인정보를 처리합니다.</p>

        <p>3. 서비스 개선 및 신규 서비스 개발<br>
          콘텐츠 제공 등 기존 서비스 제공(광고 포함)에 더하여, 인구통계학적 분석, 서비스 이용기록 분석을 통한 맞춤형 서비스 제공 및 신규 서비스 개발의 목적으로 개인정보를 처리하며, 기존 서비스
          개선
          및 신규 서비스 개발에는 인공지능(AI) 기술 적용이 포함됩니다.</p>

        <p>4. 이용자 보호 및 안전한 서비스 운영<br>
          관계 법령 및 이용약관을 위반하는 회원에 대한 이용 제한 조치, 부정 이용 행위에 대한 방지 및 제재 등 보안, 프라이버시 보호를 포함한 안전한 서비스 환경 구축을 위하여 개인정보를 처리합니다.
        </p>
        <br>
        <p><strong>02 개인정보의 수집 항목</strong><br>
          회사는 원활한 서비스 제공을 위해 다음과 같은 이용자의 개인정보를 수집하고 있습니다.</p>

        <p>[수집하는 개인정보 항목]</p>
        <p>1. 회원가입시<br>
          ID, 메일주소, 비밀번호, 생년월일, 성별, 이름, 휴대폰번호, 주소, 닉네임, 고객 상담 내역, 검색이력, 거래기록, 방문기록, 콘텐츠 생성・열람・추천을 포함한 서비스 이용기록,
          부정이용기록,
          IP주소, 운영체제 정보・인터페이스・언어 설정과 같은 단말기 정보</p>

        <p>2. 본인인증시<br>
          이름, 휴대폰번호, 생년월일, 성별, CI, DI, 통신사, 내/외국인 여부</p>

        <p>3. 신용정보 확인 시<br>
          자택주소, 실거주지 주소, 직장주소, 휴대폰번호, 이메일, 직장명, 부서, 신용거래기간, 사업자정보(사업자등록번호, 상호명, 대표자명, 업종, 사업제주소, 업력(신용거래기간), 이용자가
          개인사업자인
          경우만 해당)</p>

        <p>4. 계좌 등록시<br>
          금융기관명, 계좌번호, 예금주명, 자동이체 출금동의</p>

        <p>5. 계좌번호 송금시<br>
          받는 사람의 금융기관명, 계좌번호</p>

        <p>6. 카드 등록시<br>
          카드번호, 유효기간, CVC, 비밀번호 2자리, 카드사 제공정보(회원ID, 카드ID, OTC(가상카드번호), 마스킹한 카드번호, 카드BIN, CAVV, XID, ECI, 토큰유효기간)</p>

        <p>7. 서비스 이용시<br>
          서비스 이용기록(금융거래내역, IP, 단말기정보 등), 위치정보</p>

        <p>8. 고객상담시<br>
          고객상담 내역(본인확인시 : 이름/생년월일/휴대폰번호/신분증 사본(주민번호 뒷자리 마스킹), 이용정지 해제시 : 얼굴/신분증/확인문구가 포함된 사진)</p>

        <p>9. 고객확인 의무 수행시<br>
          집 주소, 사용목적, 자금원천, 직업, 신분증(주민등록증, 운전면허증, 외국인등록증, 강화된 고객확인 시)</p>

        <p>10. 송금확인증 신청 / 개인정보 이용·제공 내역 신청 시<br>
          이메일주소</p>

        <p>11. (선택) 마케팅 정보 수신 동의시<br>
          휴대폰번호, 이메일주소</p>
        <br>
        <p><strong>03 개인정보의 보유 및 이용기간</strong></p>
        <p>이용자의 개인정보는 수집 및 이용목적이 달성된 때에 지체없이 파기합니다. ('수집 및 이용 목적이 달성된 때'는 이용자 동의 철회요청, 서비스계약 만료, 회원 탈퇴 시를 의미합니다.)</p>

        <p>단, 회사 내부 방침 또는 관계 법령에서 정한 보관기간이 있을 경우 일정 기간동안 보관한 후에 파기합니다.</p>

        <p><strong>회사 내부 방침 : 부정 이용 방지 사유</strong><br>
          부정 이용 기록 (ID, 이름, 휴대전화번호, CI, DI, 계좌정보, 서비스이용기록) : 5년</p>

        <p><strong>회사 내부 방침 : 중복 가입방지, 분쟁 해결, 민원 처리 사유</strong><br>
          탈퇴 회원 기록 (본인인증정보, 계좌정보, 서비스이용기록) : 6개월</p>

        <p><strong>관계 법령 보관 기간</strong></p>
        <ul>
          <li>전자상거래 등에서의 소비자 보호에 관한 법률<br>
            - 계약 또는 청약철회 등에 관한 기록 : 5년<br>
            - 대금결제 및 재화 등의 공급에 관한 기록 : 5년<br>
            - 소비자의 불만 또는 분쟁처리에 관한 기록 : 3년<br>
            - 표시/광고에 관한 기록 : 6개월</li>
          <li>국세기본법<br>
            - 세법이 규정하는 모든 거래에 관한 장부 및 증명서류 : 5년</li>
          <li>전자금융거래법<br>
            - 전자금융 거래에 관한 기록 및 부정거래 기록 : 5년</li>
          <li>특정 금융거래정보의 보고 및 이용 등에 관한 법률<br>
            - 고객확인 정보 및 보고대상 금융거래자료의 송금인 및 수취인 정보 : 5년</li>
          <li>통신비밀보호법<br>
            - 서비스 방문기록 : 3개월</li>
        </ul>

        <p>개인정보 수집 및 이용목적이 달성된 개인정보 및 법령에 따른 보관기간이 경과한 개인정보는 지체없이 재생이 불가능한 방법으로 파기합니다. 종이에 출력된 개인정보는 분쇄기로 분쇄하거나 소각을
          통하여
          파기하고, 전자적 파일 형태로 저장된 개인정보는 기록을 재생할 수 없는 기술적 방법을 사용하여 삭제합니다.</p>

        <p>위 개인정보 제공 동의는 필수 항목으로 서비스 이용에 필요한 최소한의 정보입니다. AVOPIC 회원은 위 개인정보 제공 동의를 거부할 권리가 있으나, 위 개인정보 제공 동의 거부 시
          AVOPIC
          서비스 이용에 일부 제한이 있을 수 있습니다. 그 밖의 내용은 개인정보 처리방침을 따릅니다.</p>
      </div>
      <div class="join-agreement-check">
        <input type="checkbox" id="required-agreement" required>
        <label for="required-agreement">동의하십니까?</label>
      </div>
    </div>

    <!-- 선택 약관 부분 수정 -->
    <div class="join-agreement-container">
      <div class="join-agreement-header" onclick="toggleAgreement('marketing-agreement-box')">
        <h3 class="join-h3">(선택) 마케팅 정보 수신 동의</h3>
        <span class="join-agreement-toggle">▼</span>
      </div>
      <div id="marketing-agreement-box" class="join-agreement-box">
        <p>"AVOPIC"(이하 "회사")는 "정보통신망 이용촉진 및 정보보호에 관한 법률", "개인정보보호법" 등 관계 법령에 따라 광고성 정보를 전송하기 위해 수신자의 사전 수신 동의를 받고 있으며,
          광고성 정보 수신자의 수신 동의 여부를 정기적으로 확인합니다. 다만 동의하지 않을 경우, 상품/서비스 소개 및 권유, 사은행사, 판촉행사 등 이용목적에 따른 혜택에 제한이 있을 수 있습니다.
        </p>
        <p><strong>01. 목적</strong><br>
          문자 메세지(알림톡) 및 이메일을 통한 광고성 정보 전송<br>
          제휴사 소식, 혜택, 이벤트, 광고 등 마케팅에 활용<br>
          서비스 이용에 따른 정보성 안내는 수신 동의 여부와 무관하게 제공됩니다.</p>
        <p><strong>02. 이용항목</strong><br>
          휴대폰번호, 이메일주소</p>
        <p><strong>03. 보유 및 이용기간</strong><br>
          마케팅 활용 동의일로부터 탈퇴 또는 동의철회 시까지</p>
        <p>* 본 동의는 선택동의로서 거부하실 수 있으며, 거부하시더라도 서비스 이용에는 제한이 없습니다.<br>
          * 마케팅 정보 수신 동의/해제는 언제든지 회원 마이페이지에서 변경하실 수 있습니다.</p>
      </div>
      <div class="join-agreement-check">
        <input type="checkbox" id="marketing-agreement">
        <label for="marketing-agreement">동의하십니까?</label>
      </div>
    </div>
    </form>

<!-- 가입 정보 섹션 -->
<div class="join-required-section">
  <h3 class="join-h3">가입 정보</h3>
  <div class="join-form-group">
    <label for="join-email">이메일 주소:</label>
    <input type="email" id="join-email" required>
  </div>

  <div class="join-form-group">
    <label for="join-password">비밀번호:</label>
    <input type="password" id="join-password" required>
  </div>

  <div class="join-form-group">
    <label for="join-confirmPassword">비밀번호 확인:</label>
    <input type="password" id="join-confirmPassword" required>
  </div>

  <div class="join-form-group">
    <label for="join-username">활동명:</label>
    <input type="text" id="join-username" required>
  </div>

  <div class="join-optional-notice">
    <div class="join-optional-desc">📦 추후 이벤트, 경품 발송 및 구매 상품 배송에 입력된 정보를 활용합니다.</div>
    <div class="join-optional-warning">❌ 절대 다른 용도로 사용되지 않습니다.</div>
  </div>

  <div class="join-form-group">
    <label for="join-name">이름:</label>
    <input type="text" id="join-name" required>
  </div>

  <div class="join-form-group">
    <label for="join-phone">휴대폰 번호:</label>
    <input type="tel" id="join-phone" pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}" placeholder="010-1234-5678" required>
  </div>

  <div class="join-form-group">
    <label for="join-address">주소:</label>
    <input type="text" id="join-address" required>
  </div>

  <div class="join-form-group">
    <label for="join-gender">성별:</label>
    <select id="join-gender" required>
      <option value="male">남성</option>
      <option value="female">여성</option>
      <option value="other">기타</option>
    </select>
  </div>

  <div class="join-form-group">
    <label for="join-birthdate">생년월일:</label>
    <input type="date" id="join-birthdate" required>
  </div>

</div>

<button type="button" class="join-button" onclick="joinValidateForm()">회원가입</button>
</form>
</div>

<script>
  function toggleAgreement(boxId) {
    const box = document.getElementById(boxId);
    const header = box.previousElementSibling;
    const toggle = header.querySelector('.join-agreement-toggle');

    box.classList.toggle('show');
    toggle.classList.toggle('active');
  }

  async function joinValidateForm() {
    // 필수 동의 체크 확인
    const requiredAgreement = document.getElementById('required-agreement');
    if (!requiredAgreement.checked) {
      alert('개인정보 수집 및 이용 동의는 필수입니다.');
      return;
    }

    const password = document.getElementById('join-password').value;
    const confirmPassword = document.getElementById('join-confirmPassword').value;

    if (password !== confirmPassword) {
      alert("비밀번호가 일치하지 않습니다.");
      return;
    }

    // 선택 동의 체크 확인
    const marketingAgreement = document.getElementById('marketing-agreement').checked;

    // 폼 데이터 수집
    const formData = {
      email: document.getElementById('join-email').value,
      password: password,
      username: document.getElementById('join-username').value,
      birthdate: document.getElementById('join-birthdate').value,
      gender: document.getElementById('join-gender').value,
      name: document.getElementById('join-name').value,
      phone: document.getElementById('join-phone').value,
      address: document.getElementById('join-address').value,
      agreements: {
        privacyPolicy: requiredAgreement.checked,
        marketing: marketingAgreement
      }
    };

    try {
      const response = await fetch('/join', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      if (response.ok) {
        alert('회원가입이 완료되었습니다.');
        window.location.href = '/login';
      } else {
        alert(data.message || '회원가입 중 오류가 발생했습니다.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('회원가입 중 오류가 발생했습니다.');
    }
  }
</script>